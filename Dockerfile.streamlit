# 1. Base image: Python 3.11 slim
FROM python:3.11-slim

# 2. Install system packages needed for PDF/OCR preview (optional but safe)
RUN apt-get update && apt-get install -y --no-install-recommends \
    tesseract-ocr \
    poppler-utils \
    && rm -rf /var/lib/apt/lists/*

# 3. Set workdir
WORKDIR /app

# 4. Copy only requirements first (for caching)
COPY requirements.txt /app/requirements.txt

# 5. Install dependencies
RUN pip install --no-cache-dir -r requirements.txt

# 6. Copy rest of project
COPY . /app

# 7. Expose the Streamlit port
EXPOSE 8501

# 8. Environment variable for backend URL (update below)
ENV API_BASE="https://docuchat-api-kgca.onrender.com" \
    OPENAI_MODEL="gpt-4o-mini"

# 9. Run Streamlit app
CMD ["sh", "-c", "streamlit run app_streamlit.py --server.address 0.0.0.0 --server.port ${PORT:-8501}"]
